<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RecipeMaster API Tester</title>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            max-width: 1000px; 
            margin: 0 auto; 
            padding: 20px; 
            background: #f5f5f5;
        }
        .container { 
            background: white; 
            padding: 20px; 
            border-radius: 8px; 
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        button { 
            background: #FF6B35; 
            color: white; 
            border: none; 
            padding: 8px 12px; 
            margin: 2px; 
            border-radius: 4px; 
            cursor: pointer;
            font-size: 12px;
        }
        button:hover { background: #e55a2b; }
        .btn-edit { background: #2EC4B6; }
        .btn-edit:hover { background: #25a99c; }
        .btn-delete { background: #e74c3c; }
        .btn-delete:hover { background: #c0392b; }
        .product-card {
            background: #f8f9fa;
            padding: 15px;
            margin: 10px 0;
            border-radius: 6px;
            border-left: 4px solid #FF6B35;
        }
        .product-card h3 {
            margin: 0 0 10px 0;
            color: #333;
        }
        .product-info {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 10px;
        }
        .product-actions {
            display: flex;
            gap: 5px;
        }
        input, textarea { 
            width: 100%; 
            padding: 8px; 
            margin: 5px 0; 
            border: 1px solid #ddd; 
            border-radius: 4px;
            box-sizing: border-box;
        }
        .form-container {
            background: #f0f8ff;
            padding: 15px;
            border-radius: 6px;
            margin: 15px 0;
        }
        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üç≥ RecipeMaster API Tester</h1>
        
        <h2>üì¶ Gesti√≥n de Productos</h2>
        
        <!-- Botones principales -->
        <button onclick="getProducts()">üîÑ Actualizar Lista</button>
        <button onclick="showCreateForm()">‚ûï Crear Producto</button>
        
        <!-- Formulario de creaci√≥n -->
        <div id="createForm" class="form-container hidden">
            <h3>Crear Nuevo Producto</h3>
            <input type="text" id="name" placeholder="Nombre del producto">
            <input type="number" id="price" placeholder="Precio" step="0.01">
            <textarea id="description" placeholder="Descripci√≥n" rows="3"></textarea>
            <input type="number" id="stock" placeholder="Stock">
            <button onclick="createProduct()">‚úÖ Crear Producto</button>
            <button onclick="hideCreateForm()">‚ùå Cancelar</button>
        </div>

        <!-- Formulario de edici√≥n -->
        <div id="editForm" class="form-container hidden">
            <h3>Editar Producto</h3>
            <input type="hidden" id="editId">
            <input type="text" id="editName" placeholder="Nombre del producto">
            <input type="number" id="editPrice" placeholder="Precio" step="0.01">
            <textarea id="editDescription" placeholder="Descripci√≥n" rows="3"></textarea>
            <input type="number" id="editStock" placeholder="Stock">
            <button onclick="updateProduct()">üíæ Guardar Cambios</button>
            <button onclick="hideEditForm()">‚ùå Cancelar</button>
        </div>

        <!-- Lista de productos -->
        <div id="productsList"></div>
    </div>

    <script>
        const API_URL = 'http://localhost:3000/api';

        // Mostrar/ocultar formularios
        function showCreateForm() {
            document.getElementById('createForm').classList.remove('hidden');
            document.getElementById('editForm').classList.add('hidden');
        }

        function hideCreateForm() {
            document.getElementById('createForm').classList.add('hidden');
            clearCreateForm();
        }

        function showEditForm(product) {
            document.getElementById('editId').value = product.id;
            document.getElementById('editName').value = product.name;
            document.getElementById('editPrice').value = product.price;
            document.getElementById('editDescription').value = product.description;
            document.getElementById('editStock').value = product.stock;
            
            document.getElementById('editForm').classList.remove('hidden');
            document.getElementById('createForm').classList.add('hidden');
        }

        function hideEditForm() {
            document.getElementById('editForm').classList.add('hidden');
        }

        function clearCreateForm() {
            document.getElementById('name').value = '';
            document.getElementById('price').value = '';
            document.getElementById('description').value = '';
            document.getElementById('stock').value = '';
        }

        // Obtener todos los productos
        async function getProducts() {
            try {
                const response = await fetch(`${API_URL}/products`);
                const products = await response.json();
                displayProducts(products);
            } catch (error) {
                alert('Error al obtener productos: ' + error.message);
            }
        }

        // Crear nuevo producto
        async function createProduct() {
            const productData = {
                name: document.getElementById('name').value,
                price: parseFloat(document.getElementById('price').value),
                description: document.getElementById('description').value,
                stock: parseInt(document.getElementById('stock').value)
            };

            if (!productData.name || !productData.price) {
                alert('Nombre y precio son obligatorios');
                return;
            }

            try {
                const response = await fetch(`${API_URL}/products`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(productData)
                });
                
                if (response.ok) {
                    clearCreateForm();
                    hideCreateForm();
                    getProducts(); // Actualizar lista
                    alert('‚úÖ Producto creado exitosamente');
                } else {
                    throw new Error('Error en la respuesta del servidor');
                }
            } catch (error) {
                alert('Error al crear producto: ' + error.message);
            }
        }

        // Actualizar producto
        async function updateProduct() {
            const productId = document.getElementById('editId').value;
            const productData = {
                name: document.getElementById('editName').value,
                price: parseFloat(document.getElementById('editPrice').value),
                description: document.getElementById('editDescription').value,
                stock: parseInt(document.getElementById('editStock').value)
            };

            try {
                const response = await fetch(`${API_URL}/products/${productId}`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(productData)
                });
                
                if (response.ok) {
                    hideEditForm();
                    getProducts(); // Actualizar lista
                    alert('‚úÖ Producto actualizado exitosamente');
                } else {
                    throw new Error('Error al actualizar producto');
                }
            } catch (error) {
                alert('Error al actualizar producto: ' + error.message);
            }
        }

        // Eliminar producto
        async function deleteProduct(productId) {
            if (!confirm('¬øEst√°s seguro de que quieres eliminar este producto?')) {
                return;
            }

            try {
                const response = await fetch(`${API_URL}/products/${productId}`, {
                    method: 'DELETE'
                });
                
                if (response.ok) {
                    getProducts(); // Actualizar lista
                    alert('‚úÖ Producto eliminado exitosamente');
                } else {
                    throw new Error('Error al eliminar producto');
                }
            } catch (error) {
                alert('Error al eliminar producto: ' + error.message);
            }
        }

        // Mostrar productos en formato de tarjetas
        function displayProducts(products) {
            const productsList = document.getElementById('productsList');
            
            if (products.length === 0) {
                productsList.innerHTML = '<p>No hay productos registrados.</p>';
                return;
            }

            productsList.innerHTML = products.map(product => `
                <div class="product-card">
                    <h3>${product.name}</h3>
                    <div class="product-info">
                        <div><strong>Precio:</strong> $${product.price}</div>
                        <div><strong>Stock:</strong> ${product.stock}</div>
                        <div><strong>Descripci√≥n:</strong> ${product.description || 'Sin descripci√≥n'}</div>
                        <div><strong>Creado:</strong> ${new Date(product.createdAt).toLocaleDateString()}</div>
                    </div>
                    <div class="product-actions">
                        <button class="btn-edit" onclick="showEditForm(${JSON.stringify(product).replace(/"/g, '&quot;')})">
                            ‚úèÔ∏è Editar
                        </button>
                        <button class="btn-delete" onclick="deleteProduct(${product.id})">
                            üóëÔ∏è Eliminar
                        </button>
                    </div>
                </div>
            `).join('');
        }

        // Cargar productos al iniciar
        window.onload = getProducts;
    </script>
</body>
</html>